
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Wush筆記</title>
  <meta name="author" content="Wush978">

  
  <meta name="description" content="R 中function也可以是一種物件型態，或稱做叫作closure: 1
2
&gt; typeof(rnorm)
[1] &quot;closure&quot; 要比較兩個function物件，則可透過body這個函數： 1
2
3
4
&gt; body(rnorm) == body( &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wush978.github.com/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Wush筆記" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29552301-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Wush筆記</a></h1>
  
    <h2>紀錄學習過程的點點滴滴</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wush978.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/14/r-closure/">R Closure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-14T22:27:00+08:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/14/r-closure/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>R 中<em>function</em>也可以是一種物件型態，或稱做叫作<em>closure</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>typeof<span class="p">(</span>rnorm<span class="p">)</span>
</span><span class='line'><span class="go">[1] &quot;closure&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>要比較兩個function物件，則可透過<code>body</code>這個函數：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>body<span class="p">(</span>rnorm<span class="p">)</span> <span class="o">==</span> body<span class="p">(</span>rexp<span class="p">)</span>
</span><span class='line'><span class="go">[1] FALSE</span>
</span><span class='line'><span class="gp">&gt; </span>body<span class="p">(</span>rnorm<span class="p">)</span> <span class="o">==</span> body<span class="p">(</span>temp<span class="p">)</span>
</span><span class='line'><span class="go">[1] TRUE</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/20/latex-in-octopress/">Latex in Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-20T13:01:00+08:00" pubdate data-updated="true">Jun 20<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/20/latex-in-octopress/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>大致上參考<a href="http://chen.yanping.me/cn/blog/2012/03/10/octopress-with-latex/">在Octopress中使用Latex</a>即可。</p>

<h1>安裝</h1>

<ol>
<li>安裝kramdown</li>
</ol>


<figure class='code'><figcaption><span>install-kramdown</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install kramdown
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>修改<code>/source/_includes/custom/head.html</code></li>
</ol>


<figure class='code'><figcaption><span>head.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- mathjax config similar to math.stackexchange --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-mathjax-config&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Config</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">tex2jax</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">inlineMath</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="s1">&#39;$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;\\(&quot;</span><span class="p">,</span><span class="s2">&quot;\\)&quot;</span><span class="p">]</span> <span class="p">],</span>
</span><span class='line'>      <span class="nx">processEscapes</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-mathjax-config&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Config</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">tex2jax</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">skipTags</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;noscript&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">]</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-mathjax-config&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Queue</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">all</span> <span class="o">=</span> <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">getAllJax</span><span class="p">(),</span> <span class="nx">i</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">all</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">SourceElement</span><span class="p">().</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; has-jax&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span>
</span><span class='line'>   <span class="na">src=</span><span class="s">&quot;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>使用注意事項</h1>

<ol>
<li>這個是我自己測出來的bug: <em>在latex中的符號 <code>^</code> 之後要接空格才能正常使用</em>。</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/18/cormen-chp6/">Cormen Chp6</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-18T22:53:00+08:00" pubdate data-updated="true">Jun 18<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/18/cormen-chp6/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Heapsort</h1>

<h2>6.1 Heaps</h2>

<h3>Heap Introduction</h3>

<ul>
<li>sorts $n$ elements in $O(nlog(n))$</li>
<li>in place
  ps. <em>in place</em> : only used $O(1)$ additional memory to store data</li>
<li>heat property: $$\mbox{Parent[PARENT(i)] } \leq \mbox{ A[i]}$$</li>
</ul>


<h3>Exercise</h3>

<h4>6.1-1</h4>

<p>min: $2 ^ h$<br/>
max: $2 ^ h - 1$</p>

<h4>6.1-2</h4>

<p>Mathematical Induction</p>

<h4>6.1-3</h4>

<p>Trivial</p>

<h4>6.1-4</h4>

<p>Leaf</p>

<h4>6.1-5</h4>

<p>Yes, it is</p>

<h4>6.1-6</h4>

<p>No, $6 &lt; 7$</p>

<h4>6.1-7</h4>

<p>Proof:
$$
\begin{eqnarray}
&amp; &amp; k \mbox{-th element is a leaf iff } 2k > n \newline
&amp;\Rightarrow&amp; k \geq \lfloor n/2 \rfloor + 1
\end{eqnarray}
$$</p>

<h2>6.2 Maintaining the heap property</h2>

<p><code>MaxHeapify(A,i)</code> convert a heap that the subtree rooted at $2 i$ and
$2 i + 1$ are max-heaps, but $A[i]$ might be smaller than one of its
child, thus violating the max-heap property.</p>

<p>The idea is to float-down $A[i]$.</p>

<h3>Exercise</h3>

<h4>6.2-6</h4>

<p>Give a special case such as root 0 and node 1.</p>

<h2>6.3 Building a heap</h2>

<p>Do <code>MaxHeapify(A,i)</code> from the leaf to the root.</p>

<ul>
<li>Initial: leaf is a valid subtree with heap property</li>
<li>Maintain: for each step of heapify, heap property is maintained</li>
<li>Termination:</li>
</ul>


<h3>Exercise</h3>

<h4>6.3-2</h4>

<p>Because <code>MaxHeapify(A,i)</code> needs <code>left(i)</code> and <code>right(i)</code> are subtree
with heap property.</p>

<h2>6.4 The heapsort algorithm</h2>

<h1>My own implementation</h1>

<p>File /home/wush/git-project/octopress-blog/source/downloads/code/cormen/data_structure/Heap.hpp could not be found
File /home/wush/git-project/octopress-blog/source/downloads/code/cormen/sorting/HeapSort.hpp could not be found</p>

<h1>Reference</h1>

<p>See my github repository: <a href="https://github.com/wush978/cormen">cormen</a> for details of the code.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/14/profiling-r-code/">Profiling R Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-14T23:29:00+08:00" pubdate data-updated="true">Jun 14<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/14/profiling-r-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>簡介</h1>

<p>Profiling的意思就是去測量程式中每個函數的執行時間。
根據經驗法則，通常有80%的執行時間耗費在20%的程式碼中！
所以若有提昇執行效能的需求，第一步就是找出跑得慢得程式碼(bottlenecks)，再針對慢得程式碼去做優化。</p>

<h1>介紹</h1>

<p>ps. 以下的程式碼取自<a href="http://www.math.ncu.edu.tw/~chenwc/R_note/reference/debug/Rdebug.pdf">Rdebug</a></p>

<p>考慮以下三個函數：</p>

<figure class='code'><figcaption><span>fun1.R</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fun1 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  res <span class="o">&lt;-</span> <span class="kc">NULL</span>
</span><span class='line'>  n <span class="o">&lt;-</span> nrow<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">1</span>:n<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kr">if</span> <span class="p">(</span>!any<span class="p">(</span>is.na<span class="p">(</span>x<span class="p">[</span>i<span class="p">,])))</span> <span class="p">{</span>
</span><span class='line'>          res <span class="o">&lt;-</span> rbind<span class="p">(</span>res<span class="p">,</span> x<span class="p">[</span>i<span class="p">,])</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  res
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>fun2.R</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fun2 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  n <span class="o">&lt;-</span> nrow<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'>  res <span class="o">&lt;-</span> matrix<span class="p">(</span><span class="m">0</span><span class="p">,</span> n<span class="p">,</span> ncol<span class="p">(</span>x<span class="p">))</span>
</span><span class='line'>  k <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">1</span>:n<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kr">if</span> <span class="p">(</span>!any<span class="p">(</span>is.na<span class="p">(</span>x<span class="p">[</span>i<span class="p">,])))</span> <span class="p">{</span>
</span><span class='line'>          res<span class="p">[</span>k<span class="p">,]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="p">,]</span>
</span><span class='line'>          k <span class="o">&lt;-</span> k <span class="o">+</span> <span class="m">1</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  res<span class="p">[</span><span class="m">1</span>:<span class="p">(</span>k<span class="o">-</span><span class="m">1</span><span class="p">),]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>fun3.R</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fun3 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  omit <span class="o">&lt;-</span> <span class="kc">FALSE</span>
</span><span class='line'>  n <span class="o">&lt;-</span> ncol<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">1</span>:n<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      omit <span class="o">&lt;-</span> omit <span class="o">|</span> is.na<span class="p">(</span>x<span class="p">[,</span>i<span class="p">])</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  x<span class="p">[</span>!omit<span class="p">,]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>將上述三個function分別寫成script檔案後，執行：</p>

<figure class='code'><figcaption><span>Rprof-exp-1.R</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>source<span class="p">(</span><span class="s">&#39;fun1.R&#39;</span><span class="p">)</span>
</span><span class='line'>source<span class="p">(</span><span class="s">&#39;fun2.R&#39;</span><span class="p">)</span>
</span><span class='line'>source<span class="p">(</span><span class="s">&#39;fun3.R&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>size.row <span class="o">&lt;-</span> <span class="m">10</span>L<span class="o">^</span><span class="m">5</span>
</span><span class='line'>size.col <span class="o">&lt;-</span> <span class="m">20</span>L
</span><span class='line'>
</span><span class='line'>x <span class="o">=</span> matrix<span class="p">(</span>rnorm<span class="p">(</span>size.row <span class="o">*</span> size.col<span class="p">),</span>size.row<span class="p">,</span>size.col<span class="p">)</span>
</span><span class='line'>x<span class="p">[</span>x <span class="o">&gt;</span> <span class="m">1.5</span><span class="p">]</span> <span class="o">=</span> <span class="kc">NA</span>
</span><span class='line'>Rprof<span class="p">(</span><span class="s">&quot;method1.out&quot;</span><span class="p">)</span>
</span><span class='line'>fun1<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'>Rprof<span class="p">(</span><span class="kc">NULL</span><span class="p">)</span>
</span><span class='line'>Rprof<span class="p">(</span><span class="s">&quot;method2.out&quot;</span><span class="p">)</span>
</span><span class='line'>fun2<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'>Rprof<span class="p">(</span><span class="kc">NULL</span><span class="p">)</span>
</span><span class='line'>Rprof<span class="p">(</span><span class="s">&quot;method3.out&quot;</span><span class="p">)</span>
</span><span class='line'>fun3<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'>Rprof<span class="p">(</span><span class="kc">NULL</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>此時根目錄會有<code>method1.out</code>, <code>method2.out</code>, <code>method3.out</code>等三個檔案。</p>

<p>打開命令列，執行：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>R CMD Rprof method1.out
</span><span class='line'>R CMD Rprof method2.out
</span><span class='line'>R CMD Rprof method3.out
</span></code></pre></td></tr></table></div></figure>


<p>以<code>R CMD Rprof method1.out</code>的結果為例：</p>

<pre><code>Each sample represents 0.02 seconds.
Total run time: 168.98 seconds.

Total seconds: time spent in function and callees.
Self seconds: time spent in function alone.

   %       total       %        self
 total    seconds     self    seconds    name
 100.0    168.98       0.4      0.74     fun1
  99.4    167.98      99.4    167.98     rbind
   0.1      0.20       0.1      0.20     any
   0.0      0.04       0.0      0.04     is.na
   0.0      0.02       0.0      0.02     !


   %        self       %      total
  self    seconds    total   seconds    name
  99.4    167.98      99.4    167.98     rbind
   0.4      0.74     100.0    168.98     fun1
   0.1      0.20       0.1      0.20     any
   0.0      0.04       0.0      0.04     is.na
   0.0      0.02       0.0      0.02     !
</code></pre>

<p>這份報告共有兩個表格：</p>

<ul>
<li>表格一：

<ul>
<li><code>fun1</code>(進入到退出之間)總共花了168.98秒，佔總時間的100%，但是本身(扣除可以分割的部份)只花了0.74秒，佔0.4%</li>
<li><code>rbind</code>(進去到退出之間)花了167.98秒，佔總時間的99.4%，但是本身花了167.98秒，佔整體的99.4%</li>
</ul>
</li>
<li>表格二則和表格一類似，只是表格一是依照進入和退出間所佔的時間來排序，而表格二是依照本身的執行時間來排序。</li>
</ul>


<p>由此可知，我們只要能夠針對表格二的前面數列的函數進行優化，就可以大幅度改進程式效能。</p>

<p>接下來看<code>R CMD Rprof method2.out</code>的結果：</p>

<pre><code>Each sample represents 0.02 seconds.
Total run time: 0.58 seconds.

Total seconds: time spent in function and callees.
Self seconds: time spent in function alone.

   %       total       %        self
 total    seconds     self    seconds    name
 100.0      0.58      69.0      0.40     fun2
  13.8      0.08      13.8      0.08     any
  10.3      0.06      10.3      0.06     is.na
   3.4      0.02       3.4      0.02     !
   3.4      0.02       3.4      0.02     matrix


   %        self       %      total
  self    seconds    total   seconds    name
  69.0      0.40     100.0      0.58     fun2
  13.8      0.08      13.8      0.08     any
  10.3      0.06      10.3      0.06     is.na
   3.4      0.02       3.4      0.02     !
   3.4      0.02       3.4      0.02     matrix
</code></pre>

<p>這裡使用<code>matrix</code>來取代<code>rbind</code>之後，剩下效能的瓶頸就落在<code>any</code>上。
所以<code>fun3</code>更進一步的不使用<code>any</code>，得到：</p>

<pre><code>Each sample represents 0.02 seconds.
Total run time: 0.12 seconds.

Total seconds: time spent in function and callee
Self seconds: time spent in function alone.

   %       total       %        self
 total    seconds     self    seconds    name
 100.0      0.12      16.7      0.02     fun3
  66.7      0.08      66.7      0.08     |
  16.7      0.02      16.7      0.02     is.na


   %        self       %      total
  self    seconds    total   seconds    name
  66.7      0.08      66.7      0.08     |
  16.7      0.02     100.0      0.12     fun3
  16.7      0.02      16.7      0.02     is.na
</code></pre>

<p>可以看到效能又好了近5倍(0.12 : 0.58)！</p>

<h1>參考資料</h1>

<ul>
<li><a href="http://www.math.ncu.edu.tw/~chenwc/R_note/reference/debug/Rdebug.pdf">Rdebug</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/14/r-debug/">R Debug</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-14T01:11:00+08:00" pubdate data-updated="true">Jun 14<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/14/r-debug/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>簡介</h1>

<p>很少人能夠第一次寫程式就能寫對，就連最專業的程式設計師也會花大把大把的時間在除錯。
所以熟悉除錯的工具也是能夠顯著的提昇寫程式的效率。</p>

<p>其實作者我在寫這篇文章之前也完全沒用過除錯工具！想到又能提昇自己的coding效率又讓我熊熊的燃燒起來！！</p>

<h1>除錯函數</h1>

<p>R 提供了以下的除錯功能:</p>

<ul>
<li><code>traceback</code></li>
<li><code>browser</code></li>
<li><code>debug</code></li>
<li><code>trace</code></li>
</ul>


<p>就讓我來一個個探索吧！</p>

<h2>traceback</h2>

<p>所謂的traceback功能主要的目的，是找出錯誤發生時最後執行的函數：</p>

<figure class='code'><figcaption><span>traceback-example-1</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fail_func1 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  b <span class="o">&lt;-</span> <span class="m">5</span>
</span><span class='line'>  b <span class="o">&lt;-</span> b <span class="o">+</span> size
</span><span class='line'>  b <span class="o">&lt;-</span> b <span class="o">*</span> <span class="m">2</span>
</span><span class='line'>  b <span class="o">&lt;-</span> b<span class="o">^</span><span class="m">2</span>
</span><span class='line'>  b
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  b <span class="o">&lt;-</span> fail_func1<span class="p">(</span>size<span class="p">)</span>
</span><span class='line'>  a <span class="o">&lt;-</span> sample<span class="p">(</span><span class="m">0</span>:<span class="m">1</span><span class="p">,</span>size<span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
</span><span class='line'>  a
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span><span class='line'>traceback<span class="p">()</span>
</span><span class='line'>fail_func2<span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
</span><span class='line'>traceback<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>運行結果：</p>

<figure class='code'><figcaption><span>traceback-example-1-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span><span class='line'><span class="go">Error in sample(0:1, size, FALSE) : </span>
</span><span class='line'><span class="go">  cannot take a sample larger than the population when &#39;replace = FALSE&#39;</span>
</span><span class='line'><span class="gp">&gt; </span>traceback<span class="p">()</span>
</span><span class='line'><span class="go">2: sample(0:1, size, FALSE) at #3</span>
</span><span class='line'><span class="go">1: fail_func2(12)</span>
</span><span class='line'><span class="gp">&gt; </span>fail_func2<span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
</span><span class='line'><span class="go">Error in b + size : non-numeric argument to binary operator</span>
</span><span class='line'><span class="gp">&gt; </span>traceback<span class="p">()</span>
</span><span class='line'><span class="go">2: fail_func1(size) at #2</span>
</span><span class='line'><span class="go">1: fail_func2(&quot;test&quot;)</span>
</span><span class='line'><span class="gp">&gt; </span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看出traceback確實的找出最後一個丟出錯誤的函數。</p>

<h2>browser</h2>

<p>traceback只能指出錯誤的發生處，並不能幫助使用者找出程式的錯誤。
接下來的<code>browser</code>指令則提供互動式的除錯功能：</p>

<ul>
<li>暫停程式碼的執行</li>
<li>讓使用者能察看某個時間點的變數狀態，甚至是修改變數狀態。此時以下的指令變成有特殊意義：

<ul>
<li><code>c</code> 讓程式繼續進行</li>
<li><code>n</code> 執行下一行</li>
<li><code>Q</code> 中斷</li>
</ul>
</li>
<li>繼續執行</li>
</ul>


<p>ps. 如果在中斷期間要查詢名稱為<code>c</code>、<code>n</code>、<code>Q</code>的變數內容，請用<code>print</code>指令。
但是我個人是認為不應該把變數取這類名稱！！</p>

<p>如果運行以下的指令：</p>

<figure class='code'><figcaption><span>browser-example-1</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>global_env <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>fail_func1 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  fail_func1_env <span class="o">&lt;-</span> <span class="m">5</span>
</span><span class='line'>  browser<span class="p">()</span>
</span><span class='line'>  fail_func1_env <span class="o">&lt;-</span> <span class="m">6</span>
</span><span class='line'>  fail_func1_env <span class="o">&lt;-</span> <span class="m">7</span>
</span><span class='line'>  fail_func1_env
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  fail_func2_env <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>  b <span class="o">&lt;-</span> fail_func1<span class="p">(</span>size<span class="p">)</span>
</span><span class='line'>  a <span class="o">&lt;-</span> sample<span class="p">(</span><span class="m">0</span>:<span class="m">1</span><span class="p">,</span>size<span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
</span><span class='line'>  a
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>應該會看到類似以下的結果：</p>

<figure class='code'><figcaption><span>browser-example-1-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span><span class='line'><span class="go">Called from: fail_func1(size)</span>
</span><span class='line'><span class="go">Browse[1]&gt; global_env</span>
</span><span class='line'><span class="go">[1] 1</span>
</span><span class='line'><span class="go">Browse[1]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 5</span>
</span><span class='line'><span class="go">Browse[1]&gt; fail_func2_env</span>
</span><span class='line'><span class="go">Error: object &#39;fail_func2_env&#39; not found</span>
</span><span class='line'><span class="go">Browse[1]&gt; size</span>
</span><span class='line'><span class="go">[1] 12</span>
</span><span class='line'><span class="go">Browse[1]&gt; n</span>
</span><span class='line'><span class="go">debug at #4: fail_func1_env &lt;- 6</span>
</span><span class='line'><span class="go">Browse[2]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 5</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug at #5: fail_func1_env &lt;- 7</span>
</span><span class='line'><span class="go">Browse[2]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 6</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug at #6: fail_func1_env</span>
</span><span class='line'><span class="go">Browse[2]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 7 </span>
</span></code></pre></td></tr></table></div></figure>


<p>在程式跑到<code>browser</code>時就暫停了。
因為<code>browser</code>是插入在<code>fail_func1</code>的第二行，所以變數應該和該時間點相同，
值得注意的是此時也只能存取該function environment內的變數</p>

<h2>debug</h2>

<p>我們可以把上一節的<code>browser</code>視為一種<em>中斷點</em>，
而<code>debug</code>函數則可以幫一個函數的每一行加入中斷點。
在對內建函數除錯的時候非常有用：</p>

<figure class='code'><figcaption><span>debug-example-1</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>debug<span class="p">(</span>lm<span class="p">)</span>
</span><span class='line'>lm<span class="p">(</span>Sepal.Length~Species<span class="p">,</span>iris<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>debug-example-1-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>lm<span class="p">(</span>Sepal.Length~Species<span class="p">,</span>iris<span class="p">)</span>
</span><span class='line'><span class="go">debugging in: lm(Sepal.Length ~ Species, iris)</span>
</span><span class='line'><span class="go">debug: {</span>
</span><span class='line'><span class="go">    ret.x &lt;- x</span>
</span><span class='line'><span class="go">    ret.y &lt;- y</span>
</span><span class='line'><span class="go">... 略 ...</span>
</span><span class='line'><span class="go">    z</span>
</span><span class='line'><span class="go">}</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug: ret.x &lt;- x</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug: ret.y &lt;- y</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug: cl &lt;- match.call()</span>
</span></code></pre></td></tr></table></div></figure>


<p>除錯完畢後可用<code>undebug</code>來將中斷點移除。</p>

<h2>trace</h2>

<p>有時候只是檢視或修改變數並不夠。
<code>trace</code>函數能在除錯時插入程式碼到某個函數，
並在<code>untrace</code>後還原該函數。</p>

<figure class='code'><figcaption><span>str(trace)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>str<span class="p">(</span>trace<span class="p">)</span>
</span><span class='line'><span class="go">function (what, tracer, exit, at, print, signature, where = topenv(parent.frame()), </span>
</span><span class='line'><span class="go">    edit = FALSE)  </span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>what</code>: 要修改的函數名稱</li>
<li><code>tracer</code>: 要插入的函數或expression。<code>trace</code>會在<code>at</code>給的行數之前執行，或是<code>what</code>開始之前執行。</li>
<li><code>exit</code>: 當<code>what</code>結束之後執行的函數或expression</li>
<li><code>at</code>: <code>trace</code>執行的行數。</li>
</ul>


<p>其他的參數請參閱trace的說明。</p>

<p>測試一下：</p>

<figure class='code'><figcaption><span>trace-example-1</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>test_func <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">2</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">3</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>trace<span class="p">(</span>test_func<span class="p">,</span> browser<span class="p">,</span> browser<span class="p">)</span>
</span><span class='line'>test_func<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>trace-example-1-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>test_func<span class="p">()</span>
</span><span class='line'><span class="go">Tracing test_func() on entry </span>
</span><span class='line'><span class="go">Called from: eval(expr, envir, enclos)</span>
</span><span class='line'><span class="go">Browse[1]&gt; a</span>
</span><span class='line'><span class="go">Error: object &#39;a&#39; not found</span>
</span><span class='line'><span class="go">Browse[1]&gt; c</span>
</span><span class='line'><span class="go">Tracing test_func() on exit </span>
</span><span class='line'><span class="go">Called from: eval(expr, envir, enclos)</span>
</span><span class='line'><span class="go">Browse[1]&gt; a</span>
</span><span class='line'><span class="go">[1] 3</span>
</span><span class='line'><span class="go">Browse[1]&gt; c</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到第一次browser是在執行test_func之前，所以<code>a</code>不存在。
第二次則是離開的時候，所以<code>a</code>為<code>3</code>。</p>

<figure class='code'><figcaption><span>trace-example-2</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>test_func <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">2</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">3</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>trace<span class="p">(</span>test_func<span class="p">,</span> quote<span class="p">(</span>print<span class="p">(</span>a<span class="p">)),</span> at<span class="o">=</span><span class="m">3</span>:<span class="m">4</span><span class="p">)</span> <span class="c1">#利用quote直接插入print(a)到程式中</span>
</span><span class='line'>body<span class="p">(</span>test_func<span class="p">)</span>
</span><span class='line'>test_func<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>trace-example-2-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>body<span class="p">(</span>test_func<span class="p">)</span>
</span><span class='line'><span class="go">{</span>
</span><span class='line'><span class="go">    a &lt;- 1</span>
</span><span class='line'><span class="go">    {</span>
</span><span class='line'><span class="go">        .doTrace(print(a), &quot;step 3&quot;)</span>
</span><span class='line'><span class="go">        a &lt;- 2</span>
</span><span class='line'><span class="go">    }</span>
</span><span class='line'><span class="go">    {</span>
</span><span class='line'><span class="go">        .doTrace(print(a), &quot;step 4&quot;)</span>
</span><span class='line'><span class="go">        a &lt;- 3</span>
</span><span class='line'><span class="go">    }</span>
</span><span class='line'><span class="go">}</span>
</span><span class='line'><span class="gp">&gt; </span>test_func<span class="p">()</span>
</span><span class='line'><span class="go">Tracing test_func() step 3 </span>
</span><span class='line'><span class="go">[1] 1</span>
</span><span class='line'><span class="go">Tracing test_func() step 4 </span>
</span><span class='line'><span class="go">[1] 2</span>
</span><span class='line'><span class="gp">&gt; </span>
</span></code></pre></td></tr></table></div></figure>


<p>搭配quote使用可以直接更改function的程式碼，好用好用！
注意at參數所代表的位置！！(讓我滿意外的)</p>

<h2>自動debug</h2>

<p>輸入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>options<span class="p">(</span>error <span class="o">=</span> browser<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以在發生錯誤時候進入browser</p>

<p>更強大的debug設定是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>options<span class="p">(</span>error <span class="o">=</span> recover<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>在錯誤發生時候會印出stack，並且可以選擇要進入哪層stack來<code>browser</code></p>

<h1>Reference</h1>

<p><a href="http://www.math.ncu.edu.tw/~chenwc/R_note/reference/debug/Rdebug.pdf">Rdebug</a>
<a href="http://rstudio.github.com/shiny/tutorial/#run-and-debug">Shiny Tutorial</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/04/rcpp-2/">Rcpp-2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-04T13:56:00+08:00" pubdate data-updated="true">Jun 4<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/04/rcpp-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文延續<a href="/blog/2012/02/28/rcpp/">Rcpp-1</a>。</p>

<h1>從R傳遞資料到C++</h1>

<h2>傳遞到對應的物件</h2>

<h3>Vector</h3>

<p>在R的底層之中，最基礎的資料型態就是某六種型態的vector(詳情請見下表)。
傳遞這六種資料型態的vector到C++並不難，只要宣告對應的Rcpp class以及把透過<code>.Call</code>傳遞進來的SEXP丟到Rcpp class的constructor內就好了。</p>

<p>表一：</p>

<table>
<thead>
<tr>
<th>atomic type</th>
<th>Rcpp Class</th>
</tr>
</thead>
<tbody>
<tr>
<td>logical</td>
<td>LogicalVector</td>
</tr>
<tr>
<td>integer</td>
<td>IntegerVector</td>
</tr>
<tr>
<td>double</td>
<td>NumericVector</td>
</tr>
<tr>
<td>complex</td>
<td>ComplexVector</td>
</tr>
<tr>
<td>character</td>
<td>CharacterVector</td>
</tr>
<tr>
<td>raw</td>
<td>RawVector</td>
</tr>
</tbody>
</table>


<p>ps. 在R中，幾乎所有物件都是vector</p>

<p>以<code>integer</code>為例子:</p>

<figure class='code'><figcaption><span>test-rcpp.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;Rcpp.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">Rcpp</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">RcppExport</span> <span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RIntegerVec</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">r_int_vec</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">IntegerVector</span> <span class="n">int_vec</span><span class="p">(</span><span class="n">r_int_vec</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">R_len_t</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">int_vec</span><span class="p">.</span><span class="n">length</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">int_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> length: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">int_vec</span><span class="p">.</span><span class="n">length</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">R_NilValue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>編譯後，在R底下執行</p>

<figure class='code'><figcaption><span>test.R</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>dyn.load<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span><span class='line'>a <span class="o">&lt;-</span> <span class="m">1</span>L:<span class="m">10</span>L
</span><span class='line'><span class="m">.</span>Call<span class="p">(</span><span class="s">&quot;R2CppInteger&quot;</span><span class="p">,</span> a<span class="p">)</span>
</span><span class='line'>dyn.unload<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>就會看到輸出</p>

<pre><code>1 2 3 4 5 6 7 8 9 10 
 length: 10 
NULL
</code></pre>

<p>如果需要使用上的細節，只需要查閱<a href="http://dirk.eddelbuettel.com/code/rcpp/html/classVector.html">Rcpp Reference中關於Vector</a>的部分。</p>

<p>而Rcpp還有許多可以直接傳遞其他進階的R物件的C++物件。</p>

<h3>Matrix</h3>

<p>因為R中的matrix 或 array 物件其實就是加上dimension的vector，所以可以直接用xxxVector物件在C++內處理。
Rcpp中另外還有更類似R的matrix的xxxMatrix物件。
只是要注意，在C++裡面取出來的row或column在C++裡的型態會是<code>Rcpp::xxxMatrix::Row</code>或<code>Rcpp::xxxMatrix::Column</code>。請見以下範例：</p>

<figure class='code'><figcaption><span>test-rcpp.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;Rcpp.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">Rcpp</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">RcppExport</span> <span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RIntegerVec</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">r_int_mat</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">IntegerMatrix</span> <span class="n">int_mat</span><span class="p">(</span><span class="n">r_int_mat</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;print the matrix</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">int_mat</span><span class="p">.</span><span class="n">nrow</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">int_mat</span><span class="p">.</span><span class="n">ncol</span><span class="p">();</span><span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">int_mat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;print the first column: &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">IntegerMatrix</span><span class="o">::</span><span class="n">Column</span> <span class="n">int_mat_col</span><span class="p">(</span> <span class="n">int_mat</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">NamedPlaceHolder</span><span class="p">(),</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">);</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">int_mat</span><span class="p">.</span><span class="n">nrow</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">int_mat_col</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">R_NilValue</span><span class="p">;</span> 
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>編譯之後在R底下執行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>dyn.load<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span><span class='line'>a <span class="o">&lt;-</span> matrix<span class="p">(</span><span class="m">1</span>L:<span class="m">10</span>L<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
</span><span class='line'><span class="m">.</span>Call<span class="p">(</span><span class="s">&quot;R2CppInteger&quot;</span><span class="p">,</span> a<span class="p">)</span>
</span><span class='line'>dyn.unload<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>就可以看到輸出</p>

<pre><code>print the matrix
1 3 5 7 9 
2 4 6 8 10 
print the first column: 1 2 
NULL
</code></pre>

<h3>List</h3>

<p>list物件在R也是非常的重要，而且和上述的vector型態已經不一樣了。
在R中，一個vector內的資料一定只能是相同的atomic type，但是在list中就可以放不同的atomic type。
說穿了，List物件也只是R物件的vector，這從Rcpp中List的定義：<code>typedef Vector&lt;VECSXP&gt; List</code>可窺見一二。</p>

<figure class='code'><figcaption><span>test-rcpp.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;Rcpp.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">Rcpp</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">RcppExport</span> <span class="n">SEXP</span> <span class="n">R2CppList</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RList</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Function</span> <span class="n">show</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">SEXP</span> <span class="n">R2CppList</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RList</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">List</span> <span class="n">list</span><span class="p">(</span><span class="n">RList</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">R_len_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">list</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">show</span><span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">R_NilValue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ps. 這裡的Function是Rcpp中呼叫R function的方式，之後會再介紹。這裡的用途只是把傳入的東西以R中的<code>show</code>函數顯示到console上。</p>

<p>編譯之後在R底下執行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>dyn.load<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span><span class='line'>a <span class="o">&lt;-</span> list<span class="p">()</span>
</span><span class='line'>a<span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="m">1</span>L:<span class="m">10</span>L
</span><span class='line'>a<span class="p">[[</span><span class="s">&#39;a&#39;</span><span class="p">]]</span> <span class="o">&lt;-</span> paste<span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="m">1</span>:<span class="m">10</span><span class="p">)</span>
</span><span class='line'>a<span class="p">[[</span><span class="m">2</span><span class="p">]]</span> <span class="o">&lt;-</span> factor<span class="p">(</span>sample<span class="p">(</span><span class="m">1</span>:<span class="m">2</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">))</span>
</span><span class='line'><span class="m">.</span>Call<span class="p">(</span><span class="s">&quot;R2CppList&quot;</span><span class="p">,</span> a<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>就可以看到：</p>

<pre><code> [1]  1  2  3  4  5  6  7  8  9 10
 [1] 2 2 1 2 2 1 2 1 1 2
Levels: 1 2
NULL
</code></pre>

<h3>data.frame</h3>

<p>data.frame 其實就只是滿足某些條件的List物件，所以是可以用List物件來做處理的。
除此之外Rcpp也提供C++物件：DataFrame給使用者。
但是目前除了提供方便的建立DataFrame物件之外，只有類似List的操作方法。在此就不提供範例了。</p>

<h2>傳遞到STL物件</h2>

<p>Rcpp可以利用<code>as&lt;&gt;</code>函數將R物件轉換成對應的STL物件
。</p>

<h1>參考資料</h1>

<ul>
<li><a href="http://cran.r-project.org/doc/manuals/R-lang.html#Vector-objects">R Language Definition</a></li>
<li><a href="http://cran.r-project.org/web/packages/Rcpp/vignettes/Rcpp-quickref.pdf">Rcpp Quick Reference Guide</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/04/shi-yong-interactive-charts-and-slides-with-r/">試用Interactive Charts and Slides With R</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-04T10:18:00+08:00" pubdate data-updated="true">Jun 4<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/04/shi-yong-interactive-charts-and-slides-with-r/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>簡介</h1>

<p>新版的RStudio(0.98.228) 推出了<a href="http://www.rstudio.org/docs/authoring/using_markdown">Using Markdown with RStudio</a>，這對於我這個markdown愛好者來說可是大利多呀!!</p>

<p>簡單來說，就是透過以下的流程產生文件:</p>

<p>Rmd &#8211;> Markdown &#8211;> HTML</p>

<p>這裡的Markdown同時還支援:</p>

<ul>
<li><a href="https://github.github.com/github-flavored-markdown">Github的擴充</a>，更方便的插入code block</li>
<li><a href="https://github.com/tanoku/sundown">Sundown</a>，支援表格等其他功能</li>
<li><a href="http://www.mathjax.org/">MathJax</a>，支援數學方程式</li>
</ul>


<p>想了就覺得非常方便!</p>

<h1>使用</h1>

<ol>
<li>安裝R package <a href="http://yihui.name/knitr/">knitr</a>。我在2.13版本之前的R是無法安裝的，所以想試用的朋友記得把R的版本更新。</li>
<li>打開Rstudio ，File &#8211;> New &#8211;> R Markdown</li>
<li>編輯markdown檔案，儲存為<code>xxx.Rmd</code>或<code>xxx.md</code>。注意: 副檔名若為<code>md</code>，就無法使用嵌入R圖片的功能。</li>
<li>點選編輯器上的<code>Knit HTML</code>就可以預覽產生的HTML格式。目前我個人在這部分遇到困難: 我沒有辦法把R畫出來的圖嵌入產生的HTML內。</li>
</ol>


<h1>語法範例</h1>

<p>這裡是我試過的範例。有興趣的大大可以到<a href="https://github.com/yihui/knitr/tree/master/inst/examples">knitr-example</a> 看看更多的範例。</p>

<ul>
<li>嵌入R語法:

<pre><code>  ``` {r}
  cat("hello world")
  ```
</code></pre></li>
<li>嵌入R圖面

<pre><code>  ``` {r 圖片標題, message=FALSE, fig.width=7, fig.height=5}
  plot(cars)
  ```
</code></pre></li>
<li>行內嵌入方程式

<pre><code>  $latex X_t = \mu_t + \varepsilon_t$
</code></pre></li>
<li>方程式區塊

<pre><code>  $$latex
      \begin{aligned}
      X_t = \mu_t + \varepsilon_t \\
      \varepsilon_t ~ Normal(0,1)
      \end{aligned}
  $$
</code></pre></li>
<li>跳脫字元

<ul>
<li>要跳脫<code>$latex</code>，使用HTML的語法: <code>&amp;#36;latex</code></li>
</ul>
</li>
</ul>


<h1>全命令列環境</h1>

<p>根據stackoverflow裏的某位大大提示，其實knitr套件提供了直接在R中轉換.Rmd至.md的語法：</p>

<figure class='code'><figcaption><span>rmd2md</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>require<span class="p">(</span>knitr<span class="p">)</span> <span class="c1"># required for knitting from rmd to md</span>
</span><span class='line'>require<span class="p">(</span>markdown<span class="p">)</span> <span class="c1"># required for md to html </span>
</span><span class='line'>knit<span class="p">(</span><span class="s">&#39;test.rmd&#39;</span><span class="p">,</span> <span class="s">&#39;test.md&#39;</span><span class="p">)</span> <span class="c1"># creates md file</span>
</span><span class='line'>markdownToHTML<span class="p">(</span><span class="s">&#39;test.md&#39;</span><span class="p">,</span> <span class="s">&#39;test.html&#39;</span><span class="p">)</span> <span class="c1"># creates html file</span>
</span><span class='line'>browseURL<span class="p">(</span>paste<span class="p">(</span><span class="s">&#39;file://&#39;</span><span class="p">,</span> file.path<span class="p">(</span>getwd<span class="p">(),</span><span class="s">&#39;test.html&#39;</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">))</span> <span class="c1"># open file in browser</span>
</span></code></pre></td></tr></table></div></figure>


<p>理解了這件事情後，就可以寫出Makefile來在命令列編譯。</p>

<h1>我自己的擴充</h1>

<p>我都是透過php + R 來拼湊出下面這耶東西，環境都是Ubuntu</p>

<ul>
<li><a href="https://github.com/wush978/knitr2octopress">knitr2octopress</a> : 將Rmd轉換出來的.md檔案內的圖片連結，轉換為使用<a href="http://en.wikipedia.org/wiki/Data_URI_scheme">Data URI scheme</a>的格式。</li>
<li><a href="https://github.com/wush978/yml2rmd">yml2rmd</a> : 利用yml格式來產生大量圖表的.Rmd檔案，這個文件我還沒空寫, 以後慢慢補&#8230;</li>
</ul>


<h1>參考資料</h1>

<ul>
<li><a href="https://gist.github.com/2816027">Interactive charts and slides with R, googleVis and knitr</a></li>
<li><a href="http://www.r-bloggers.com/interactive-html-presentation-with-r-googlevis-knitr-pandoc-and-slidy/">R-blogger: Interactive HTML presentation with R, googleVis, knitr, pandoc and slidy</a></li>
<li><a href="http://stackoverflow.com/questions/10646665/how-to-convert-r-markdown-to-html-i-e-what-does-knit-html-do-in-rstudio-0-9">How to convert R Markdown to HTML? I.e., What does “Knit HTML” do in Rstudio 0.96?</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/12/eclipse-plugin/">Eclipse-plugin</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-12T18:16:00+08:00" pubdate data-updated="true">Mar 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/12/eclipse-plugin/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>相關的Eclipse Plugin</h1>


<ul>
<li><a href="http://subclipse.tigris.org/">Subclipse</a>

<ul>
<li>http://subclipse.tigris.org/update_1.8.x</li>
</ul>
</li>
<li><a href="https://github.com/pulse00/Symfony-2-Eclipse-Plugin/blob/master/README.md">Symfony Eclipse Plugin</a>

<ul>
<li>http://pulse00.github.com/p2/</li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/09/eclipse-svn-symfony/">Eclipse-svn-symfony</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-09T18:36:00+08:00" pubdate data-updated="true">Mar 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/09/eclipse-svn-symfony/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Subclipse功能簡介</h1>




<h2>建立本機端的repository</h2>


<ul>
<li>於eclipse內打開SVN Repository的perspective</li>
<li>於SVN Repositories視窗內右邊的倒三角形 -> New repository&#8230;</li>
<li>選擇要建立repository的位置 -> OK</li>
</ul>


<h2>建立資料夾</h2>


<ul>
<li>右鍵點選repository -> New -> New remote folder</li>
<li>輸入資料夾名稱</li>
</ul>


<h2>匯入資料</h2>


<ul>
<li>右鍵點選資料夾 -> Import&#8230;</li>
<li>於Import directory內選擇要被匯入的資料</li>
<li>於Comment:內輸入註解</li>
<li>OK</li>
</ul>


<h2>Checkout並建立專案</h2>


<ul>
<li>右鍵點選要被Checkout的資料夾 -> Checkout&#8230;</li>
<li>選擇Check out as a project configured using the New Project Wizard</li>
<li>選擇Check out HEAD revision</li>
<li>選擇Depth:為Fully recursive</li>
<li>選擇Allow unversioned obstructions</li>
<li>Finish</li>
<li>選擇專案的種類為PHP Project</li>
<li>剩下的步驟同Eclipse建立新專案的步驟</li>
</ul>


<h2 id="commit">送交至Repository(Commit)</h2>


<ul>
<li>右鍵點選已經被修改的檔案 -> Team -> Commit&#8230;</li>
<li>視窗上方輸入要commit的message</li>
<li>視窗下方確認要送交的檔案/目錄</li>
<li>OK</li>
<li>請不要在送交的message內使用中文</li>
</ul>


<h2>自專案中新增檔案/目錄</h2>


<ul>
<li>右鍵點選要新增至repository的檔案/目錄 -> Team -> Add to Version Control</li>
<li>如果要取消, 請在右鍵點選要取消的檔案/目錄 -> Team -> Revert&#8230;</li>
<li><a href="#commit">送交</a>要新增的檔案/目錄</li>
</ul>


<h2>更新Repository</h2>


<ul>
<li>右鍵點選要更新的檔案/目錄 -> Team -> Update to HEAD</li>
</ul>


<h2>刪除Repository內的檔案/目錄</h2>


<ul>
<li>刪除檔案/目錄</li>
<li>送交</li>
</ul>


<h2>移動Repository內的檔案/目錄</h2>


<ul>
<li>移動檔案/目錄</li>
<li>送交</li>
</ul>


<h2>解決衝突</h2>


<ul>
<li>送交時發生out of date錯誤</li>
<li>更新時發現File conflicts</li>
<li>Edit Conflict</li>
<li>Mark Resolved&#8230;</li>
<li>送交</li>
</ul>


<h2>清除暫存的登入帳號密碼</h2>


<ul>
<li>Windows -> Preference -> Team -> SVN 檢查Client Adapter</li>
<li>依照<a href="http://subclipse.tigris.org/wiki/PluginFAQ#head-d507c29676491f4419997a76735feb6ef0aa8cf8">Subclipse Wiki FAQ</a>的指示清除對應的資料夾</li>
</ul>


<h1>Symfony和svn</h1>


<ul>
<li>於Repository內建立三個資料夾:

<pre><code>myproject/
  branches/
  tags/
  trunk/
</code></pre></li>
<li>複製Symfony資料夾至myproject內</li>
<li>更改Symfony資料夾的名稱為專案名稱(以下仍繼續使用Symfony)</li>
<li>右鍵點選Symfony/src -> Team -> Add to Version Control</li>
<li>忽略下列檔案:

<pre><code>vendor
app/內的bootstrap*
app/config/內的 parameters.ini
app/cache/內的 *
app/logs/內的 *
web/內的 bundles
</code></pre></li>
</ul>


<h1>參考資料</h1>


<ul>
<li><a href="http://symfony.com/doc/current/cookbook/workflow/new_project_svn.html">How to Create and store a Symfony2 Project in Subversion</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/09/build-php-development-enviornment/">Php開發建置</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-09T11:23:00+08:00" pubdate data-updated="true">Mar 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/09/build-php-development-enviornment/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><a href="#env">環境</a></li>
<li><a href="#dev-tool">開發工具</a></li>
<li><a href="#build-env">建置步驟</a>

<ul>
<li><a href="#IIS-php-fastcgi">安裝IIS7 + php-fastcgi</a></li>
<li><a href="#eclipse-svn">安裝eclipse-PDT和svn</a></li>
<li><a href="#import-svn">匯入既有的SVN Repository</a></li>
<li><a href="#xdebug">安裝Xdebug</a></li>
<li><a href="#remote-debug">設定遠端除錯環境</a></li>
<li><a href="#database">設定php和MSSQL的連線</a></li>
</ul>
</li>
<li><a href="#reference">參考網頁</a></li>
</ul>


<h1 id="env">環境</h1>


<ul>
<li>server: windows 2008 R2</li>
<li>client: windows 7</li>
<li>database: MSSQL 2008 R2 Express</li>
</ul>


<h1 id="dev-tool">開發工具</h1>


<ul>
<li><a href="http://www.eclipse.org/projects/project.php?id=tools.pdt">eclipse-PDT</a></li>
<li>svn

<ul>
<li><a href="http://tortoisesvn.net/downloads.html">tortoise-svn</a></li>
<li><a href="http://subclipse.tigris.org/">subclipse</a></li>
</ul>
</li>
</ul>


<p>ps. 本文件僅測試於IIS7, php5.3.10, eclipse-PDT 3.0.2, subclipse 1.8.x, XDebug 2.1.3</p>

<h1 id="build-env">建置步驟</h1>




<h2 id="IIS-php-fastcgi">安裝IIS7 + php-fastcgi</h2>


<ol>
<li>安裝IIS7

<ul>
<li>需安裝cgi</li>
</ul>
</li>
<li>安裝<a href="http://windows.php.net/download/">php5.3</a>

<ul>
<li>下載VC9 x86 Non Thread Safe ZIP</li>
<li>解壓縮到<em>c:\php</em></li>
</ul>
</li>
<li>安裝<a href="http://www.microsoft.com/download/en/details.aspx?id=29">Microsoft Visual C++ 2008 Redistributable Package (x86)</a></li>
<li>測試以下的命令碼：

<pre><code>c:\php\php.exe -i
</code></pre>

<p>ps. 如出現<em>side-by-side effect</em>的錯誤訊息表示步驟3有問題</p></li>
<li>設定<em>php.ini</em>：

<ul>
<li>複製php.ini-development至php.ini</li>
<li>修改以下內容：
fastcgi.impersonate = 1
cgi.fix_pathinfo = 1
date.timezone = &#8220;Asia/Taipei&#8221;</li>
</ul>
</li>
<li>設定fast-cgi Mapping Handler</li>
<li>至<em>c:\inetpub\wwwroot</em>建立<em>phpinfo.php</em>並修改內容為:

<pre><code>&lt;?php phpinfo() ?&gt;
</code></pre></li>
<li>打開*http://&lt;server的ip>/phpinfo.php須出現phpinfo畫面

<ul>
<li>如出現500可能是步驟5的<em>date.timezone</em>未設定成功</li>
</ul>
</li>
</ol>


<h2 id="eclipse-svn">安裝eclipse-PDT和svn</h2>


<ol>
<li>安裝jre, 雖然我不喜歡Oracle, 但這只是為了方便&#8230; <a href="http://java.com/en/download/manual.jsp">Sun Java</a></li>
<li>下載eclipse-PDT並解壓縮至<em>c:\eclipse-php</em>
ps. jre和eclipse-PDT必須同時為x86或x64</li>
<li>執行<em>c:\eclipse-php\eclipse.exe</em></li>
<li>安裝subclipse

<ul>
<li>Help -> Install New Software</li>
<li>在Work with:欄位輸入<code>http://subclipse.tigris.org/update_1.8.x</code></li>
<li>勾選Subclipse, SVNKit; 不勾選Subclipse底下的Subclipse Integration for Mylyn 3.x (Optional)</li>
</ul>
</li>
</ol>


<h2 id="import-svn">匯入既有的SVN Repository</h2>


<ol>
<li>於eclipse內打開<code>SVN repository Exploring</code> Perspective</li>
<li>於SVN Repositories內點右鍵, 選New</li>
<li>輸入svn repository的URL</li>
</ol>


<h2 id="xdebug">安裝XDebug</h2>


<ol>
<li>下載Xdebug Windows Binary(VC9 32bit)</li>
<li>將下載的.dll複製至<em>c:\php\ext</em></li>
<li>修改php.ini，新增以下內容

<pre><code>[xdebug]
zend_extension=c:\php\ext\php_xdebug-2.1.3-5.3-vc9-nts.dll
</code></pre></li>
<li>於命令列輸入<code>c:\php\php.exe -m</code>檢查輸出內有無xdebug</li>
</ol>


<h2 id="remote-debug">設定遠端除錯環境</h2>


<ol>
<li>修改要進行除錯的eclipse設定如下:

<ul>
<li>開啟PHP專案</li>
<li>Windows -> Preferences -> PHP -> Debug
將PHP Debugger從Zend Debugger改成Xdebug後，點選右邊的Configure&#8230;</li>
<li>於Installed Debuggers內選Xdebug後點右邊的Configure</li>
<li>Accept remote seesion (JIT) 從 off 改成 any 後點OK</li>
<li>點Apply</li>
</ul>
</li>
<li>設定要開網頁的瀏覽器(僅以Firefox為例)

<ul>
<li>安裝<a href="https://addons.mozilla.org/en-US/firefox/addon/58688/">easy Xdebug for FireFox</a></li>
</ul>
</li>
<li>設定php.ini:

<pre><code>[xdebug]
zend_extension=c:\php\ext\php_xdebug-2.1.3-5.3-vc9-nts.dll
xdebug.remote_enable=On
xdebug.remote_handler="dbgp"
xdebug.remote_mode="req"
xdebug.remote_port=9000
xdebug.remote_host="YOUR.IP.GOES.HERE"
xdebug.remote_log=/path/to/xdebug_remote_log
</code></pre></li>
</ol>


<h2 id="database">設定php和MSSQL的連線</h2>


<ul>
<li>下載並安裝<a href="http://www.microsoft.com/download/en/details.aspx?id=29">VC++ 2008 Redistributable Package(x86)</a></li>
<li>下載<a href="http://www.microsoft.com/download/en/details.aspx?id=20098#system-requirements">MS Driver 3.0 for SQL Server for PHP</a></li>
<li>修改php.ini，新增:</li>
</ul>


<figure class='code'><figcaption><span>php.ini</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="c">;...</span>
</span><span class='line'><span class="na">extension</span><span class="o">=</span><span class="s">c:\php\ext\php_pdo_sqlsrv_53_nts_vc9.dll</span>
</span><span class='line'><span class="c">;...</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>檢查能否讀取</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>c:<span class="se">\p</span>hp<span class="se">\p</span>hp -m
</span></code></pre></td></tr></table></div></figure>


<p>看看有無<code>pdo_sqlsrv</code></p>

<ul>
<li>還要安裝其他相依套件，請參考<a href="http://go.microsoft.com/fwlink/?LinkId=163712"><code>http://go.microsoft.com/fwlink/?LinkId=163712</code></a>。</li>
</ul>


<p>ps. 由於我本來就已經有VC9版本的ODBC Client、pdo_sqlsrv VC9版本，所以我安裝這些版本沒問題，但是在安裝新下載的3.0版本卻問題一堆。等到之後我有和它奮鬥後再把心得Po上來吧。</p>

<h1 id="reference">參考網頁</h1>


<ul>
<li><a href="" title="http://technet.microsoft.com/zh-tw/library/dd239230(v=ws.10).aspx">設定FastCGI以裝載PHP應用程式(IIS7)</a></li>
<li><a href="http://www.eclipse.org/projects/project.php?id=tools.pdt">Eclipse PDT</a></li>
<li><a href="http://subclipse.tigris.org/">Subclipse</a></li>
<li><a href="http://xdebug.org/docs/install">Xdebug Installation</a></li>
<li><a href="http://xdebug.org/docs/remote">Xdebug Remote Debugging</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/29/using-eclipse-cdt-to-develop-rcpp-package/">Using Eclipse CDT to develop Rcpp Package</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/11/xts-and-rcpp/">xts and Rcpp</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/07/rtwmap/">Rtwmap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/03/unicode-escape-in-r/">unicode escape in R</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/24/r-package-installation-tips-on-ubuntu/">R package installation tips on Ubuntu</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Wush978 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wush978';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
