
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Wush筆記</title>
  <meta name="author" content="Wush978">

  
  <meta name="description" content="簡介 很少人能夠第一次寫程式就能寫對，就連最專業的程式設計師也會花大把大把的時間在除錯。
所以熟悉除錯的工具也是能夠顯著的提昇寫程式的效率。 其實作者我在寫這篇文章之前也完全沒用過除錯工具！想到又能提昇自己的coding效率又讓我熊熊的燃燒起來！！ 除錯函數 R 提供了以下的除錯功能: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wush978.github.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Wush筆記" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29552301-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Wush筆記</a></h1>
  
    <h2>紀錄學習過程的點點滴滴</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wush978.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/14/r-debug/">R Debug</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-14T01:11:00+08:00" pubdate data-updated="true">Jun 14<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/14/r-debug/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>簡介</h1>

<p>很少人能夠第一次寫程式就能寫對，就連最專業的程式設計師也會花大把大把的時間在除錯。
所以熟悉除錯的工具也是能夠顯著的提昇寫程式的效率。</p>

<p>其實作者我在寫這篇文章之前也完全沒用過除錯工具！想到又能提昇自己的coding效率又讓我熊熊的燃燒起來！！</p>

<h1>除錯函數</h1>

<p>R 提供了以下的除錯功能:</p>

<ul>
<li><code>traceback</code></li>
<li><code>browser</code></li>
<li><code>debug</code></li>
<li><code>trace</code></li>
</ul>


<p>就讓我來一個個探索吧！</p>

<h2>traceback</h2>

<p>所謂的traceback功能主要的目的，是找出錯誤發生時最後執行的函數：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fail_func1 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  b <span class="o">&lt;-</span> <span class="m">5</span>
</span><span class='line'>  b <span class="o">&lt;-</span> b <span class="o">+</span> size
</span><span class='line'>  b <span class="o">&lt;-</span> b <span class="o">*</span> <span class="m">2</span>
</span><span class='line'>  b <span class="o">&lt;-</span> b<span class="o">^</span><span class="m">2</span>
</span><span class='line'>  b
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  b <span class="o">&lt;-</span> fail_func1<span class="p">(</span>size<span class="p">)</span>
</span><span class='line'>  a <span class="o">&lt;-</span> sample<span class="p">(</span><span class="m">0</span>:<span class="m">1</span><span class="p">,</span>size<span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
</span><span class='line'>  a
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span><span class='line'>traceback<span class="p">()</span>
</span><span class='line'>fail_func2<span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
</span><span class='line'>traceback<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>運行結果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span><span class='line'><span class="go">Error in sample(0:1, size, FALSE) : </span>
</span><span class='line'><span class="go">  cannot take a sample larger than the population when &#39;replace = FALSE&#39;</span>
</span><span class='line'><span class="gp">&gt; </span>traceback<span class="p">()</span>
</span><span class='line'><span class="go">2: sample(0:1, size, FALSE) at #3</span>
</span><span class='line'><span class="go">1: fail_func2(12)</span>
</span><span class='line'><span class="gp">&gt; </span>fail_func2<span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
</span><span class='line'><span class="go">Error in b + size : non-numeric argument to binary operator</span>
</span><span class='line'><span class="gp">&gt; </span>traceback<span class="p">()</span>
</span><span class='line'><span class="go">2: fail_func1(size) at #2</span>
</span><span class='line'><span class="go">1: fail_func2(&quot;test&quot;)</span>
</span><span class='line'><span class="gp">&gt; </span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看出traceback確實的找出最後一個丟出錯誤的函數。</p>

<h2>browser</h2>

<p>traceback只能指出錯誤的發生處，並不能幫助使用者找出程式的錯誤。
接下來的<code>browser</code>指令則提供互動式的除錯功能：</p>

<ul>
<li>暫停程式碼的執行</li>
<li>讓使用者能察看某個時間點的變數狀態，甚至是修改變數狀態。此時以下的指令變成有特殊意義：

<ul>
<li><code>c</code> 讓程式繼續進行</li>
<li><code>n</code> 執行下一行</li>
<li><code>Q</code> 中斷</li>
</ul>
</li>
<li>繼續執行</li>
</ul>


<p>ps. 如果在中斷期間要查詢名稱為<code>c</code>、<code>n</code>、<code>Q</code>的變數內容，請用<code>print</code>指令。
但是我個人是認為不應該把變數取這類名稱！！</p>

<p>如果運行以下的指令：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>global_env <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>fail_func1 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  fail_func1_env <span class="o">&lt;-</span> <span class="m">5</span>
</span><span class='line'>  browser<span class="p">()</span>
</span><span class='line'>  fail_func1_env <span class="o">&lt;-</span> <span class="m">6</span>
</span><span class='line'>  fail_func1_env <span class="o">&lt;-</span> <span class="m">7</span>
</span><span class='line'>  fail_func1_env
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>size<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  fail_func2_env <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>  b <span class="o">&lt;-</span> fail_func1<span class="p">(</span>size<span class="p">)</span>
</span><span class='line'>  a <span class="o">&lt;-</span> sample<span class="p">(</span><span class="m">0</span>:<span class="m">1</span><span class="p">,</span>size<span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
</span><span class='line'>  a
</span><span class='line'><span class="p">}</span>
</span><span class='line'>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>應該會看到類似以下的結果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>fail_func2<span class="p">(</span><span class="m">12</span><span class="p">)</span>
</span><span class='line'><span class="go">Called from: fail_func1(size)</span>
</span><span class='line'><span class="go">Browse[1]&gt; global_env</span>
</span><span class='line'><span class="go">[1] 1</span>
</span><span class='line'><span class="go">Browse[1]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 5</span>
</span><span class='line'><span class="go">Browse[1]&gt; fail_func2_env</span>
</span><span class='line'><span class="go">Error: object &#39;fail_func2_env&#39; not found</span>
</span><span class='line'><span class="go">Browse[1]&gt; size</span>
</span><span class='line'><span class="go">[1] 12</span>
</span><span class='line'><span class="go">Browse[1]&gt; n</span>
</span><span class='line'><span class="go">debug at #4: fail_func1_env &lt;- 6</span>
</span><span class='line'><span class="go">Browse[2]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 5</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug at #5: fail_func1_env &lt;- 7</span>
</span><span class='line'><span class="go">Browse[2]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 6</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug at #6: fail_func1_env</span>
</span><span class='line'><span class="go">Browse[2]&gt; fail_func1_env</span>
</span><span class='line'><span class="go">[1] 7 </span>
</span></code></pre></td></tr></table></div></figure>


<p>在程式跑到<code>browser</code>時就暫停了。
因為<code>browser</code>是插入在<code>fail_func1</code>的第二行，所以變數應該和該時間點相同，
值得注意的是此時也只能存取該function environment內的變數</p>

<h2>debug</h2>

<p>我們可以把上一節的<code>browser</code>視為一種<em>中斷點</em>，
而<code>debug</code>函數則可以幫一個函數的每一行加入中斷點。
在對內建函數除錯的時候非常有用：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>debug<span class="p">(</span>lm<span class="p">)</span>
</span><span class='line'>lm<span class="p">(</span>Sepal.Length~Species<span class="p">,</span>iris<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>lm<span class="p">(</span>Sepal.Length~Species<span class="p">,</span>iris<span class="p">)</span>
</span><span class='line'><span class="go">debugging in: lm(Sepal.Length ~ Species, iris)</span>
</span><span class='line'><span class="go">debug: {</span>
</span><span class='line'><span class="go">    ret.x &lt;- x</span>
</span><span class='line'><span class="go">    ret.y &lt;- y</span>
</span><span class='line'><span class="go">... 略 ...</span>
</span><span class='line'><span class="go">    z</span>
</span><span class='line'><span class="go">}</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug: ret.x &lt;- x</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug: ret.y &lt;- y</span>
</span><span class='line'><span class="go">Browse[2]&gt; n</span>
</span><span class='line'><span class="go">debug: cl &lt;- match.call()</span>
</span></code></pre></td></tr></table></div></figure>


<p>除錯完畢後可用<code>undebug</code>來將中斷點移除。</p>

<h2>trace</h2>

<p>有時候只是檢視或修改變數並不夠。
<code>trace</code>函數能在除錯時插入程式碼到某個函數，
並在<code>untrace</code>後還原該函數。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>str<span class="p">(</span>trace<span class="p">)</span>
</span><span class='line'><span class="go">function (what, tracer, exit, at, print, signature, where = topenv(parent.frame()), </span>
</span><span class='line'><span class="go">    edit = FALSE)  </span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>what</code>: 要修改的函數名稱</li>
<li><code>tracer</code>: 要插入的函數或expression。<code>trace</code>會在<code>at</code>給的行數之前執行，或是<code>what</code>開始之前執行。</li>
<li><code>exit</code>: 當<code>what</code>結束之後執行的函數或expression</li>
<li><code>at</code>: <code>trace</code>執行的行數。</li>
</ul>


<p>其他的參數請參閱trace的說明。</p>

<p>測試一下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>test_func <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">2</span>
</span><span class='line'>  a <span class="o">&lt;-</span> <span class="m">3</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>trace<span class="p">(</span>test_func<span class="p">,</span> browser<span class="p">,</span> browser<span class="p">)</span>
</span><span class='line'>test_func<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='rconsole'><span class='line'><span class="gp">&gt; </span>test_func<span class="p">()</span>
</span><span class='line'><span class="go">Tracing test_func() on entry </span>
</span><span class='line'><span class="go">Called from: eval(expr, envir, enclos)</span>
</span><span class='line'><span class="go">Browse[1]&gt; a</span>
</span><span class='line'><span class="go">Error: object &#39;a&#39; not found</span>
</span><span class='line'><span class="go">Browse[1]&gt; c</span>
</span><span class='line'><span class="go">Tracing test_func() on exit </span>
</span><span class='line'><span class="go">Called from: eval(expr, envir, enclos)</span>
</span><span class='line'><span class="go">Browse[1]&gt; a</span>
</span><span class='line'><span class="go">[1] 3</span>
</span><span class='line'><span class="go">Browse[1]&gt; c</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到第一次browser是在執行test_func之前，所以<code>a</code>不存在。
第二次則是離開的時候，所以<code>a</code>為<code>3</code>。</p>

<h1>Reference</h1>

<p><a href="http://www.math.ncu.edu.tw/~chenwc/R_note/reference/debug/Rdebug.pdf">Rdebug</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/04/rcpp-2/">Rcpp-2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-04T13:56:00+08:00" pubdate data-updated="true">Jun 4<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/04/rcpp-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文延續<a href="/blog/2012/02/28/rcpp/">Rcpp-1</a>。</p>

<h1>從R傳遞資料到C++</h1>

<h2>傳遞到對應的物件</h2>

<h3>Vector</h3>

<p>在R的底層之中，最基礎的資料型態就是某六種型態的vector(詳情請見下表)。
傳遞這六種資料型態的vector到C++並不難，只要宣告對應的Rcpp class以及把透過<code>.Call</code>傳遞進來的SEXP丟到Rcpp class的constructor內就好了。</p>

<p>表一：</p>

<table>
<thead>
<tr>
<th>atomic type</th>
<th>Rcpp Class</th>
</tr>
</thead>
<tbody>
<tr>
<td>logical</td>
<td>LogicalVector</td>
</tr>
<tr>
<td>integer</td>
<td>IntegerVector</td>
</tr>
<tr>
<td>double</td>
<td>NumericVector</td>
</tr>
<tr>
<td>complex</td>
<td>ComplexVector</td>
</tr>
<tr>
<td>character</td>
<td>CharacterVector</td>
</tr>
<tr>
<td>raw</td>
<td>RawVector</td>
</tr>
</tbody>
</table>


<p>ps. 在R中，幾乎所有物件都是vector</p>

<p>以<code>integer</code>為例子:</p>

<figure class='code'><figcaption><span>test-rcpp.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;Rcpp.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">Rcpp</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">RcppExport</span> <span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RIntegerVec</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">r_int_vec</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">IntegerVector</span> <span class="n">int_vec</span><span class="p">(</span><span class="n">r_int_vec</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">R_len_t</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">int_vec</span><span class="p">.</span><span class="n">length</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">int_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> length: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">int_vec</span><span class="p">.</span><span class="n">length</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">R_NilValue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>編譯後，在R底下執行</p>

<figure class='code'><figcaption><span>test.R</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>dyn.load<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span><span class='line'>a <span class="o">&lt;-</span> <span class="m">1</span>L:<span class="m">10</span>L
</span><span class='line'><span class="m">.</span>Call<span class="p">(</span><span class="s">&quot;R2CppInteger&quot;</span><span class="p">,</span> a<span class="p">)</span>
</span><span class='line'>dyn.unload<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>就會看到輸出</p>

<pre><code>1 2 3 4 5 6 7 8 9 10 
 length: 10 
NULL
</code></pre>

<p>如果需要使用上的細節，只需要查閱<a href="http://dirk.eddelbuettel.com/code/rcpp/html/classVector.html">Rcpp Reference中關於Vector</a>的部分。</p>

<p>而Rcpp還有許多可以直接傳遞其他進階的R物件的C++物件。</p>

<h3>Matrix</h3>

<p>因為R中的matrix 或 array 物件其實就是加上dimension的vector，所以可以直接用xxxVector物件在C++內處理。
Rcpp中另外還有更類似R的matrix的xxxMatrix物件。
只是要注意，在C++裡面取出來的row或column在C++裡的型態會是<code>Rcpp::xxxMatrix::Row</code>或<code>Rcpp::xxxMatrix::Column</code>。請見以下範例：</p>

<figure class='code'><figcaption><span>test-rcpp.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;Rcpp.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">Rcpp</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">RcppExport</span> <span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RIntegerVec</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">SEXP</span> <span class="n">R2CppInteger</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">r_int_mat</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">IntegerMatrix</span> <span class="n">int_mat</span><span class="p">(</span><span class="n">r_int_mat</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;print the matrix</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">int_mat</span><span class="p">.</span><span class="n">nrow</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">int_mat</span><span class="p">.</span><span class="n">ncol</span><span class="p">();</span><span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">int_mat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;print the first column: &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">IntegerMatrix</span><span class="o">::</span><span class="n">Column</span> <span class="n">int_mat_col</span><span class="p">(</span> <span class="n">int_mat</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">NamedPlaceHolder</span><span class="p">(),</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">);</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">int_mat</span><span class="p">.</span><span class="n">nrow</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">int_mat_col</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Rprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">R_NilValue</span><span class="p">;</span> 
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>編譯之後在R底下執行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>dyn.load<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span><span class='line'>a <span class="o">&lt;-</span> matrix<span class="p">(</span><span class="m">1</span>L:<span class="m">10</span>L<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
</span><span class='line'><span class="m">.</span>Call<span class="p">(</span><span class="s">&quot;R2CppInteger&quot;</span><span class="p">,</span> a<span class="p">)</span>
</span><span class='line'>dyn.unload<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>就可以看到輸出</p>

<pre><code>print the matrix
1 3 5 7 9 
2 4 6 8 10 
print the first column: 1 2 
NULL
</code></pre>

<h3>List</h3>

<p>list物件在R也是非常的重要，而且和上述的vector型態已經不一樣了。
在R中，一個vector內的資料一定只能是相同的atomic type，但是在list中就可以放不同的atomic type。
說穿了，List物件也只是R物件的vector，這從Rcpp中List的定義：<code>typedef Vector&lt;VECSXP&gt; List</code>可窺見一二。</p>

<figure class='code'><figcaption><span>test-rcpp.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;Rcpp.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">Rcpp</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">RcppExport</span> <span class="n">SEXP</span> <span class="n">R2CppList</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RList</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Function</span> <span class="n">show</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">SEXP</span> <span class="n">R2CppList</span><span class="p">(</span><span class="n">SEXP</span> <span class="n">RList</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">List</span> <span class="n">list</span><span class="p">(</span><span class="n">RList</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">R_len_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">list</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">show</span><span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">R_NilValue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ps. 這裡的Function是Rcpp中呼叫R function的方式，之後會再介紹。這裡的用途只是把傳入的東西以R中的<code>show</code>函數顯示到console上。</p>

<p>編譯之後在R底下執行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>dyn.load<span class="p">(</span><span class="s">&quot;test-rcpp.so&quot;</span><span class="p">)</span>
</span><span class='line'>a <span class="o">&lt;-</span> list<span class="p">()</span>
</span><span class='line'>a<span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="m">1</span>L:<span class="m">10</span>L
</span><span class='line'>a<span class="p">[[</span><span class="s">&#39;a&#39;</span><span class="p">]]</span> <span class="o">&lt;-</span> paste<span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="m">1</span>:<span class="m">10</span><span class="p">)</span>
</span><span class='line'>a<span class="p">[[</span><span class="m">2</span><span class="p">]]</span> <span class="o">&lt;-</span> factor<span class="p">(</span>sample<span class="p">(</span><span class="m">1</span>:<span class="m">2</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">))</span>
</span><span class='line'><span class="m">.</span>Call<span class="p">(</span><span class="s">&quot;R2CppList&quot;</span><span class="p">,</span> a<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>就可以看到：</p>

<pre><code> [1]  1  2  3  4  5  6  7  8  9 10
 [1] 2 2 1 2 2 1 2 1 1 2
Levels: 1 2
NULL
</code></pre>

<h3>data.frame</h3>

<p>data.frame 其實就只是滿足某些條件的List物件，所以是可以用List物件來做處理的。
除此之外Rcpp也提供C++物件：DataFrame給使用者。
但是目前除了提供方便的建立DataFrame物件之外，只有類似List的操作方法。在此就不提供範例了。</p>

<h2>傳遞到STL物件</h2>

<p>Rcpp可以利用<code>as&lt;&gt;</code>函數將R物件轉換成對應的STL物件
。</p>

<h1>參考資料</h1>

<ul>
<li><a href="http://cran.r-project.org/doc/manuals/R-lang.html#Vector-objects">R Language Definition</a></li>
<li><a href="http://cran.r-project.org/web/packages/Rcpp/vignettes/Rcpp-quickref.pdf">Rcpp Quick Reference Guide</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/04/shi-yong-interactive-charts-and-slides-with-r/">試用Interactive Charts and Slides With R</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-04T10:18:00+08:00" pubdate data-updated="true">Jun 4<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/04/shi-yong-interactive-charts-and-slides-with-r/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>簡介</h1>

<p>新版的RStudio(0.98.228) 推出了<a href="http://www.rstudio.org/docs/authoring/using_markdown">Using Markdown with RStudio</a>，這對於我這個markdown愛好者來說可是大利多呀!!</p>

<p>簡單來說，就是透過以下的流程產生文件:</p>

<p>Rmd &#8211;> Markdown &#8211;> HTML</p>

<p>這裡的Markdown同時還支援:</p>

<ul>
<li><a href="https://github.github.com/github-flavored-markdown">Github的擴充</a>，更方便的插入code block</li>
<li><a href="https://github.com/tanoku/sundown">Sundown</a>，支援表格等其他功能</li>
<li><a href="http://www.mathjax.org/">MathJax</a>，支援數學方程式</li>
</ul>


<p>想了就覺得非常方便!</p>

<h1>使用</h1>

<ol>
<li>安裝R package <a href="http://yihui.name/knitr/">knitr</a>。我在2.13版本之前的R是無法安裝的，所以想試用的朋友記得把R的版本更新。</li>
<li>打開Rstudio ，File &#8211;> New &#8211;> R Markdown</li>
<li>編輯markdown檔案，儲存為<code>xxx.Rmd</code>或<code>xxx.md</code>。注意: 副檔名若為<code>md</code>，就無法使用嵌入R圖片的功能。</li>
<li>點選編輯器上的<code>Knit HTML</code>就可以預覽產生的HTML格式。目前我個人在這部分遇到困難: 我沒有辦法把R畫出來的圖嵌入產生的HTML內。</li>
</ol>


<h1>語法範例</h1>

<p>這裡是我試過的範例。有興趣的大大可以到<a href="https://github.com/yihui/knitr/tree/master/inst/examples">knitr-example</a> 看看更多的範例。</p>

<ul>
<li>嵌入R語法:

<pre><code>  ``` {r}
  cat("hello world")
  ```
</code></pre></li>
<li>嵌入R圖面

<pre><code>  ``` {r 圖片標題, message=FALSE, fig.width=7, fig.height=5}
  plot(cars)
  ```
</code></pre></li>
<li>行內嵌入方程式

<pre><code>  $latex X_t = \mu_t + \varepsilon_t$
</code></pre></li>
<li>方程式區塊

<pre><code>  $$latex
      \begin{aligned}
      X_t = \mu_t + \varepsilon_t \\
      \varepsilon_t ~ Normal(0,1)
      \end{aligned}
  $$
</code></pre></li>
<li>跳脫字元

<ul>
<li>要跳脫<code>$latex</code>，使用HTML的語法: <code>&amp;#36;latex</code>

<h1>參考資料</h1></li>
</ul>
</li>
</ul>


<p><a href="https://gist.github.com/2816027">Interactive charts and slides with R, googleVis and knitr</a>
<a href="http://www.r-bloggers.com/interactive-html-presentation-with-r-googlevis-knitr-pandoc-and-slidy/">R-blogger: Interactive HTML presentation with R, googleVis, knitr, pandoc and slidy</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/12/eclipse-plugin/">Eclipse-plugin</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-12T18:16:00+08:00" pubdate data-updated="true">Mar 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/12/eclipse-plugin/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>相關的Eclipse Plugin</h1>


<ul>
<li><a href="http://subclipse.tigris.org/">Subclipse</a>

<ul>
<li>http://subclipse.tigris.org/update_1.8.x</li>
</ul>
</li>
<li><a href="https://github.com/pulse00/Symfony-2-Eclipse-Plugin/blob/master/README.md">Symfony Eclipse Plugin</a>

<ul>
<li>http://pulse00.github.com/p2/</li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/09/eclipse-svn-symfony/">Eclipse-svn-symfony</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-09T18:36:00+08:00" pubdate data-updated="true">Mar 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/09/eclipse-svn-symfony/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Subclipse功能簡介</h1>




<h2>建立本機端的repository</h2>


<ul>
<li>於eclipse內打開SVN Repository的perspective</li>
<li>於SVN Repositories視窗內右邊的倒三角形 -> New repository&#8230;</li>
<li>選擇要建立repository的位置 -> OK</li>
</ul>


<h2>建立資料夾</h2>


<ul>
<li>右鍵點選repository -> New -> New remote folder</li>
<li>輸入資料夾名稱</li>
</ul>


<h2>匯入資料</h2>


<ul>
<li>右鍵點選資料夾 -> Import&#8230;</li>
<li>於Import directory內選擇要被匯入的資料</li>
<li>於Comment:內輸入註解</li>
<li>OK</li>
</ul>


<h2>Checkout並建立專案</h2>


<ul>
<li>右鍵點選要被Checkout的資料夾 -> Checkout&#8230;</li>
<li>選擇Check out as a project configured using the New Project Wizard</li>
<li>選擇Check out HEAD revision</li>
<li>選擇Depth:為Fully recursive</li>
<li>選擇Allow unversioned obstructions</li>
<li>Finish</li>
<li>選擇專案的種類為PHP Project</li>
<li>剩下的步驟同Eclipse建立新專案的步驟</li>
</ul>


<h2 id="commit">送交至Repository(Commit)</h2>


<ul>
<li>右鍵點選已經被修改的檔案 -> Team -> Commit&#8230;</li>
<li>視窗上方輸入要commit的message</li>
<li>視窗下方確認要送交的檔案/目錄</li>
<li>OK</li>
<li>請不要在送交的message內使用中文</li>
</ul>


<h2>自專案中新增檔案/目錄</h2>


<ul>
<li>右鍵點選要新增至repository的檔案/目錄 -> Team -> Add to Version Control</li>
<li>如果要取消, 請在右鍵點選要取消的檔案/目錄 -> Team -> Revert&#8230;</li>
<li><a href="#commit">送交</a>要新增的檔案/目錄</li>
</ul>


<h2>更新Repository</h2>


<ul>
<li>右鍵點選要更新的檔案/目錄 -> Team -> Update to HEAD</li>
</ul>


<h2>刪除Repository內的檔案/目錄</h2>


<ul>
<li>刪除檔案/目錄</li>
<li>送交</li>
</ul>


<h2>移動Repository內的檔案/目錄</h2>


<ul>
<li>移動檔案/目錄</li>
<li>送交</li>
</ul>


<h2>解決衝突</h2>


<ul>
<li>送交時發生out of date錯誤</li>
<li>更新時發現File conflicts</li>
<li>Edit Conflict</li>
<li>Mark Resolved&#8230;</li>
<li>送交</li>
</ul>


<h2>清除暫存的登入帳號密碼</h2>


<ul>
<li>Windows -> Preference -> Team -> SVN 檢查Client Adapter</li>
<li>依照<a href="http://subclipse.tigris.org/wiki/PluginFAQ#head-d507c29676491f4419997a76735feb6ef0aa8cf8">Subclipse Wiki FAQ</a>的指示清除對應的資料夾</li>
</ul>


<h1>Symfony和svn</h1>


<ul>
<li>於Repository內建立三個資料夾:

<pre><code>myproject/
  branches/
  tags/
  trunk/
</code></pre></li>
<li>複製Symfony資料夾至myproject內</li>
<li>更改Symfony資料夾的名稱為專案名稱(以下仍繼續使用Symfony)</li>
<li>右鍵點選Symfony/src -> Team -> Add to Version Control</li>
<li>忽略下列檔案:

<pre><code>vendor
app/內的bootstrap*
app/config/內的 parameters.ini
app/cache/內的 *
app/logs/內的 *
web/內的 bundles
</code></pre></li>
</ul>


<h1>參考資料</h1>


<ul>
<li><a href="http://symfony.com/doc/current/cookbook/workflow/new_project_svn.html">How to Create and store a Symfony2 Project in Subversion</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/09/build-php-development-enviornment/">Php開發建置</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-09T11:23:00+08:00" pubdate data-updated="true">Mar 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/09/build-php-development-enviornment/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><a href="#env">環境</a></li>
<li><a href="#dev-tool">開發工具</a></li>
<li><a href="#build-env">建置步驟</a>

<ul>
<li><a href="#IIS-php-fastcgi">安裝IIS7 + php-fastcgi</a></li>
<li><a href="#eclipse-svn">安裝eclipse-PDT和svn</a></li>
<li><a href="#import-svn">匯入既有的SVN Repository</a></li>
<li><a href="#xdebug">安裝Xdebug</a></li>
<li><a href="#remote-debug">設定遠端除錯環境</a></li>
<li><a href="#database">設定php和MSSQL的連線</a></li>
</ul>
</li>
<li><a href="#reference">參考網頁</a></li>
</ul>


<h1 id="env">環境</h1>


<ul>
<li>server: windows 2008 R2</li>
<li>client: windows 7</li>
<li>database: MSSQL 2008 R2 Express</li>
</ul>


<h1 id="dev-tool">開發工具</h1>


<ul>
<li><a href="http://www.eclipse.org/projects/project.php?id=tools.pdt">eclipse-PDT</a></li>
<li>svn

<ul>
<li><a href="http://tortoisesvn.net/downloads.html">tortoise-svn</a></li>
<li><a href="http://subclipse.tigris.org/">subclipse</a></li>
</ul>
</li>
</ul>


<p>ps. 本文件僅測試於IIS7, php5.3.10, eclipse-PDT 3.0.2, subclipse 1.8.x, XDebug 2.1.3</p>

<h1 id="build-env">建置步驟</h1>




<h2 id="IIS-php-fastcgi">安裝IIS7 + php-fastcgi</h2>


<ol>
<li>安裝IIS7

<ul>
<li>需安裝cgi</li>
</ul>
</li>
<li>安裝<a href="http://windows.php.net/download/">php5.3</a>

<ul>
<li>下載VC9 x86 Non Thread Safe ZIP</li>
<li>解壓縮到<em>c:\php</em></li>
</ul>
</li>
<li>安裝<a href="http://www.microsoft.com/download/en/details.aspx?id=29">Microsoft Visual C++ 2008 Redistributable Package (x86)</a></li>
<li>測試以下的命令碼：

<pre><code>c:\php\php.exe -i
</code></pre>

<p>ps. 如出現<em>side-by-side effect</em>的錯誤訊息表示步驟3有問題</p></li>
<li>設定<em>php.ini</em>：

<ul>
<li>複製php.ini-development至php.ini</li>
<li>修改以下內容：
fastcgi.impersonate = 1
cgi.fix_pathinfo = 1
date.timezone = &#8220;Asia/Taipei&#8221;</li>
</ul>
</li>
<li>設定fast-cgi Mapping Handler</li>
<li>至<em>c:\inetpub\wwwroot</em>建立<em>phpinfo.php</em>並修改內容為:

<pre><code>&lt;?php phpinfo() ?&gt;
</code></pre></li>
<li>打開*http://&lt;server的ip>/phpinfo.php須出現phpinfo畫面

<ul>
<li>如出現500可能是步驟5的<em>date.timezone</em>未設定成功</li>
</ul>
</li>
</ol>


<h2 id="eclipse-svn">安裝eclipse-PDT和svn</h2>


<ol>
<li>安裝jre, 雖然我不喜歡Oracle, 但這只是為了方便&#8230; <a href="http://java.com/en/download/manual.jsp">Sun Java</a></li>
<li>下載eclipse-PDT並解壓縮至<em>c:\eclipse-php</em>
ps. jre和eclipse-PDT必須同時為x86或x64</li>
<li>執行<em>c:\eclipse-php\eclipse.exe</em></li>
<li>安裝subclipse

<ul>
<li>Help -> Install New Software</li>
<li>在Work with:欄位輸入<code>http://subclipse.tigris.org/update_1.8.x</code></li>
<li>勾選Subclipse, SVNKit; 不勾選Subclipse底下的Subclipse Integration for Mylyn 3.x (Optional)</li>
</ul>
</li>
</ol>


<h2 id="import-svn">匯入既有的SVN Repository</h2>


<ol>
<li>於eclipse內打開<code>SVN repository Exploring</code> Perspective</li>
<li>於SVN Repositories內點右鍵, 選New</li>
<li>輸入svn repository的URL</li>
</ol>


<h2 id="xdebug">安裝XDebug</h2>


<ol>
<li>下載Xdebug Windows Binary(VC9 32bit)</li>
<li>將下載的.dll複製至<em>c:\php\ext</em></li>
<li>修改php.ini，新增以下內容

<pre><code>[xdebug]
zend_extension=c:\php\ext\php_xdebug-2.1.3-5.3-vc9-nts.dll
</code></pre></li>
<li>於命令列輸入<code>c:\php\php.exe -m</code>檢查輸出內有無xdebug</li>
</ol>


<h2 id="remote-debug">設定遠端除錯環境</h2>


<ol>
<li>修改要進行除錯的eclipse設定如下:

<ul>
<li>開啟PHP專案</li>
<li>Windows -> Preferences -> PHP -> Debug
將PHP Debugger從Zend Debugger改成Xdebug後，點選右邊的Configure&#8230;</li>
<li>於Installed Debuggers內選Xdebug後點右邊的Configure</li>
<li>Accept remote seesion (JIT) 從 off 改成 any 後點OK</li>
<li>點Apply</li>
</ul>
</li>
<li>設定要開網頁的瀏覽器(僅以Firefox為例)

<ul>
<li>安裝<a href="https://addons.mozilla.org/en-US/firefox/addon/58688/">easy Xdebug for FireFox</a></li>
</ul>
</li>
<li>設定php.ini:

<pre><code>[xdebug]
zend_extension=c:\php\ext\php_xdebug-2.1.3-5.3-vc9-nts.dll
xdebug.remote_enable=On
xdebug.remote_handler="dbgp"
xdebug.remote_mode="req"
xdebug.remote_port=9000
xdebug.remote_host="YOUR.IP.GOES.HERE"
xdebug.remote_log=/path/to/xdebug_remote_log
</code></pre></li>
</ol>


<h2 id="database">設定php和MSSQL的連線</h2>


<ul>
<li>下載並安裝<a href="http://www.microsoft.com/download/en/details.aspx?id=29">VC++ 2008 Redistributable Package(x86)</a></li>
<li>下載<a href="http://www.microsoft.com/download/en/details.aspx?id=20098#system-requirements">MS Driver 3.0 for SQL Server for PHP</a></li>
<li>修改php.ini，新增:</li>
</ul>


<figure class='code'><figcaption><span>php.ini</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="c">;...</span>
</span><span class='line'><span class="na">extension</span><span class="o">=</span><span class="s">c:\php\ext\php_pdo_sqlsrv_53_nts_vc9.dll</span>
</span><span class='line'><span class="c">;...</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>檢查能否讀取</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>c:<span class="se">\p</span>hp<span class="se">\p</span>hp -m
</span></code></pre></td></tr></table></div></figure>


<p>看看有無<code>pdo_sqlsrv</code></p>

<ul>
<li>還要安裝其他相依套件，請參考<a href="http://go.microsoft.com/fwlink/?LinkId=163712"><code>http://go.microsoft.com/fwlink/?LinkId=163712</code></a>。</li>
</ul>


<p>ps. 由於我本來就已經有VC9版本的ODBC Client、pdo_sqlsrv VC9版本，所以我安裝這些版本沒問題，但是在安裝新下載的3.0版本卻問題一堆。等到之後我有和它奮鬥後再把心得Po上來吧。</p>

<h1 id="reference">參考網頁</h1>


<ul>
<li><a href="" title="http://technet.microsoft.com/zh-tw/library/dd239230(v=ws.10).aspx">設定FastCGI以裝載PHP應用程式(IIS7)</a></li>
<li><a href="http://www.eclipse.org/projects/project.php?id=tools.pdt">Eclipse PDT</a></li>
<li><a href="http://subclipse.tigris.org/">Subclipse</a></li>
<li><a href="http://xdebug.org/docs/install">Xdebug Installation</a></li>
<li><a href="http://xdebug.org/docs/remote">Xdebug Remote Debugging</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/29/rdatetime/">R: DateTime格式的心得</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-29T21:53:00+08:00" pubdate data-updated="true">Feb 29<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/29/rdatetime/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><a href="#overview">概述</a></li>
<li><a href="#functions">函數心得</a>

<ul>
<li>取得當前的時間

<ul>
<li><a href="#Sys.time">Sys.time</a></li>
<li><a href="#Sys.Date">Sys.Date</a></li>
</ul>
</li>
<li>時間格式間的轉換

<ul>
<li><a href="#mktime">mktime</a></li>
<li><a href="#localtime">localtime</a></li>
<li><a href="#gmtime">gmtime</a></li>
</ul>
</li>
<li>時間和字串間的轉換

<ul>
<li><a href="#strftime">strftime</a></li>
<li><a href="#strptime">strptime</a></li>
</ul>
</li>
<li><a href="#trunc">trunc</a></li>
</ul>
</li>
<li><a href="#reference">參考資料</a></li>
</ul>


<hr />

<h2 id="overview"> 概述 </h2>


<p>R中主要的時間物件為<code>POSIXct</code>和<code>POSIXlt</code>。[Date-Time Classes]第8頁內提到設計者們在設計這類物件的考量：</p>

<ul>
<li>日期格式應該由[locale]參數來決定。</li>
<li>時間應該由電腦的Time zones來決定。</li>
<li>參考資料庫標準(SQL99 ISO)中使用的時間格式<code>timestamp with time zone</code></li>
<li>考量到跨平台，使用[POSIX]</li>
</ul>


<p>[POSIX]是以<a href="Coordinated%20Universal%20Time">UTC</a>為基準，以c語言的<code>double</code>型態來儲存的時間格式，
而<code>POSIXct</code>則是代表以這種絕對座標所表示的時間。<code>POSIXlt</code>則是另一種包含timezones的格式
(lt代表local time)。其中timezone是以屬性tzone來代表的。</p>

<p>以以下的程式碼為例：</p>

<figure class='code'><figcaption><span>example from [Date-Time Classes]</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='rout'><span class='line'><span class="gp">&gt; </span>file.info<span class="p">(</span>dir<span class="p">())[,</span> <span class="s">&quot;mtime&quot;</span><span class="p">,</span> drop<span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>
</span><span class='line'><span class="go">data                  2012-02-29 21:18:11</span>
</span></code></pre></td></tr></table></div></figure>


<p>在預設下，是以ISO標準格式來表示日期時間。</p>

<figure class='code'><figcaption><span>example from [Date-Time Classes]</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="o">&gt;</span> file_time <span class="o">&lt;-</span> file.info<span class="p">(</span>dir<span class="p">())[,</span> <span class="s">&quot;mtime&quot;</span><span class="p">,</span> drop<span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;</span> file_time
</span><span class='line'>data                  <span class="m">2012</span><span class="o">-</span><span class="m">02</span><span class="o">-</span><span class="m">29</span> <span class="m">21</span>:<span class="m">18</span>:<span class="m">11</span>
</span><span class='line'><span class="o">&gt;</span> format<span class="p">(</span>file_time<span class="p">,</span> format<span class="o">=</span><span class="s">&quot;%x %X&quot;</span><span class="p">)</span>
</span><span class='line'>data                  <span class="m">2012</span><span class="o">/</span><span class="m">2</span><span class="o">/</span><span class="m">29</span> 下午 <span class="m">09</span>:<span class="m">18</span>:<span class="m">11</span>
</span></code></pre></td></tr></table></div></figure>


<p>另外再列了幾個[Date-Time Classes]內的範例</p>

<h2 id="functions"> 函數心得 </h2>




<h3 id="Sys.time"> Sys.time </h3>




<figure class='code'><figcaption><span>Sys.time</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="kr">function</span> <span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>回傳<code>POSIXct</code>物件來表示現在的時間</p>

<h3 id="Sys.Date"> Sys.Date</h3>




<figure class='code'><figcaption><span>Sys.time</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="kr">function</span> <span class="p">()</span> <span class="p">{</span>as.Date<span class="p">(</span>as.POSIXlt<span class="p">(</span>Sys.time<span class="p">()))}</span>
</span></code></pre></td></tr></table></div></figure>


<p>回傳<code>Date</code>物件來表示現在的日期</p>

<h3 id="trunc"> trunc </h3>




<figure class='code'><figcaption><span>trunc.POSIXt</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="kr">function</span> <span class="p">(</span>x<span class="p">,</span> units <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;secs&quot;</span><span class="p">,</span> <span class="s">&quot;mins&quot;</span><span class="p">,</span> <span class="s">&quot;hours&quot;</span><span class="p">,</span> <span class="s">&quot;days&quot;</span><span class="p">),</span> <span class="m">...</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>將<code>x</code>的時間格式轉換為以<code>units</code>為單位</p>

<h2 id="reference"> 參考資料 </h3>

[Date-Time Classes]: http://www.r-project.org/doc/Rnews/Rnews_2001-2.pdf
[locale]: http://en.wikipedia.org/wiki/Locale
[UTC]: http://en.wikipedia.org/wiki/Coordinated_Universal_Time

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/28/rcpp/">Rcpp-1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-28T15:42:00+08:00" pubdate data-updated="true">Feb 28<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/28/rcpp/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Rcpp 心得 &#8211; 簡介</h1>

<ul>
<li><a href="#overview">概述</a>

<ul>
<li><a href="#background">背景知識</a></li>
<li><a href="#introduction">介紹</a></li>
<li><a href="#install">安裝</a></li>
<li><a href="#compile">編譯</a></li>
<li><a href="#reference">參考資料</a></li>
</ul>
</li>
</ul>


<hr />

<h2 id="overview"> 概述 </h2>




<h3 id="background"> 背景知識 </h3>


<p>就我所知，要能理解Rcpp的語法，你必須先對C++這個我個人認為最難學的語言先學到某種程度才行。根據<a href="http://www.amazon.com/Effective-Specific-Improve-Programs-Designs/dp/0321334876">Effective C++</a>的作者Scott Meyers的看法，C++其實是下列四種程式語言的集合(難怪很難，一個打四個!!):</p>

<ul>
<li>C的特性 (指標、陣列等等)</li>
<li>物件導向</li>
<li>STL 標準函式庫</li>
<li>Template</li>
</ul>


<p>Rcpp中大量的使用了後面三種，所以如果看不習慣Rcpp的使用者，可能得先回頭把C++後面三種的語法複習一下了。</p>

<h3 id="introduction"> 介紹 </h3>


<p><a href="http://dirk.eddelbuettel.com/code/rcpp.html">Rcpp</a> 是一個整合R和C++的library。
使用過R中的<code>.Call</code>函數的人一定會對於處理R和C之間資料結構的轉換感到很煩人，而Rcpp給我的第一個印象就是他把這些重複性很高的轉換給包起來了!所以在使用Rcpp時使用者不需要再去撰寫諸如以下的程式碼:</p>

<figure class='code'><figcaption><span>return a R integer vector with R API</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;R.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Rdefines.h&gt;</span>
</span><span class='line'><span class="n">SEXP</span> <span class="nf">foo</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">SEXP</span> <span class="n">retval</span><span class="p">;</span>
</span><span class='line'>  <span class="n">PROTECT</span><span class="p">(</span><span class="n">retval</span> <span class="o">=</span> <span class="n">NEW_INTEGER</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'>  <span class="n">INTEGER_POINTER</span><span class="p">(</span><span class="n">retval</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">INTEGER_POINTER</span><span class="p">(</span><span class="n">retval</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>  <span class="n">UNPROTECT</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在Rcpp中, 透過C++的物件導向和template語法可以用下列的語法得到相同的效果：</p>

<figure class='code'><figcaption><span>return a R integer vector with Rcpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;Rcpp.h&gt;</span>
</span><span class='line'><span class="n">RcppExport</span> <span class="n">SEXP</span> <span class="n">foo</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">Rcpp</span><span class="o">::</span><span class="n">IntegerVector</span> <span class="n">retval</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">retval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">retval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">Rcpp</span><span class="o">::</span><span class="n">wrap</span><span class="p">(</span> <span class="n">retval</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>比較上面兩段語法後，我基於以下的理由比較喜歡Rcpp的語法:</p>

<ol>
<li><p>Rcpp的語法比較簡潔。尤其是在比較<code>INTEGER_POINTER(retval)[0]</code>和<code>retval[0]</code>，
這種在真正寫功能時最常用到的語法，我比較喜歡使用後者。雖然你也可以再宣告一個指標:<code>int* retval_ptr = INTEGER_POINTER(retval)</code>
來達到類似的效果，但是對我來說, 明明都是代表<code>retval</code>這個物件，卻需要宣告兩個變數就是彆扭。</p></li>
<li><p>Rcpp可以使用更精確的型態。我認為比起<code>SEXP</code>或<code>NEW_INTEGER</code>，
<code>IntegerVector</code>是更清楚的，而且也更簡潔。除了<code>IntegerVector</code>外，Rcpp之中也定義了許許多多的型態，
甚至連<code>Matrix</code>、<code>Robj</code>(S4 object)和<code>environment</code>都有呢!</p></li>
<li><p>在物件導向的語法中我就可以依循<b>RAII(<a href="http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization">Resource Acquisition Is Initialization</a>)</b>的原則來寫code，
降低了memory leak等資源洩漏的可能，也免除了使用<code>PROTECT</code>、<code>UNPROTECT</code>的困擾。</p></li>
</ol>


<p>除了語法上吸引我之外，Rcpp還可以還可以和inline套件結合，直接在R內進行即時編譯；還可以和另一個套件sugar一起使用，再增加程式的執行效能。</p>

<h3 id="install"> 安裝 </h3>


<p>Rcpp的安裝非常簡單，和一般的R套件相同。有興趣的使用者還可以額外安裝inline或sugar來玩。
Windows的使用者請額外安裝能編譯R的工具庫: <a href="http://cran.r-project.org/bin/windows/Rtools/">Rtools</a> ，並且記得到Rcpp的目錄中不要包含空白，否則用R CMD SHLIB編譯的時候會有錯誤。</p>

<h3 id="compile"> 編譯 </h3>


<ol>
<li>使用inline，這也是最簡單的方式。以下是一個取自<a href="http://dirk.eddelbuettel.com/code/rcpp/Rcpp-FAQ.pdf">Frequently Asked Questions about Rcpp</a>的範例:</li>
</ol>


<figure class='code'><figcaption><span>Compile with R package &#8220;inline&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>fx <span class="o">&lt;-</span> cxxfunction<span class="p">(</span>signature<span class="p">(</span> x <span class="o">=</span> <span class="s">&quot;numeric&quot;</span> <span class="p">),</span> <span class="s">&#39;</span>
</span><span class='line'><span class="s">  NumericVector xx(x);</span>
</span><span class='line'><span class="s">  return wrap( std::accumulate( xx.begin(), xx.end(), 0.0));&#39;</span><span class="p">,</span>
</span><span class='line'>  plugin <span class="o">=</span> <span class="s">&quot;Rcpp&quot;</span><span class="p">)</span>
</span><span class='line'>res <span class="o">&lt;-</span> fx<span class="p">(</span> seq<span class="p">(</span> <span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> by <span class="o">=</span> <span class="m">0.5</span> <span class="p">)</span> <span class="p">)</span>
</span><span class='line'>res
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>使用R CMD SHLIB的話則需要調整compiler的參數。以下的範例是在bash底下執行，是透過修改環境變數的方式。</li>
</ol>


<figure class='code'><figcaption><span>Compile with R CMD SHLIB </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PKG_LIBS</span><span class="o">=</span><span class="k">$(</span>Rscript -e <span class="s2">&quot;Rcpp:::LdFlags()&quot;</span><span class="k">)</span>
</span><span class='line'><span class="nb">export </span><span class="nv">PKG_CXXFLAGS</span><span class="o">=</span><span class="k">$(</span>Rscript -e <span class="s2">&quot;Rcpp::CxxFlags()&quot;</span><span class="k">)</span>
</span><span class='line'>R CMD SHLIB myfile.cpp
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>在R內呼叫Rcpp的函數<code>Rcpp:::SHLIB</code>來編譯。</li>
</ol>


<figure class='code'><figcaption><span>Compile with Rcpp:::SHLIB</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>Rcpp<span class="p">:::</span>SHLIB<span class="p">(</span><span class="s">&quot;mysource.cpp&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>在windows底下，方法2.我花了很久才測出來(網路上找到資料是說只要Rcpp和他的父目錄名稱有空白就會出錯)!後來我大部分是用方法1和3了。</p>

<h3 id="reference"> 參考資料 </h3>


<ul>
<li><a href="http://dirk.eddelbuettel.com/papers/Rcpp-introduction.pdf">Rcpp: Seamless R and C++ Interface</a></li>
<li><a href="http://dirk.eddelbuettel.com/code/rcpp/Rcpp-FAQ.pdf">Frequently Asked Questions about Rcpp</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/06/14/r-debug/">R debug</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/04/rcpp-2/">Rcpp-2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/04/shi-yong-interactive-charts-and-slides-with-r/">試用Interactive charts and slides with R</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/12/eclipse-plugin/">eclipse-plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/09/eclipse-svn-symfony/">eclipse-svn-symfony</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Wush978 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wush978';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
